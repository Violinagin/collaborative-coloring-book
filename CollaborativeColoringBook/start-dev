#!/bin/bash
# start-dev - Universal development starter
set -e  # Exit on error

echo "ğŸš€ ForkArt Development Starter"
echo "=============================="

# Cleanup
echo "ğŸ§¹ Cleaning caches..."
rm -rf $TMPDIR/metro-* 2>/dev/null || true
rm -rf $TMPDIR/haste-* 2>/dev/null || true
rm -rf .expo 2>/dev/null || true

# Detect environment
LOCAL_IP=$(node -e "
const os = require('os');
const interfaces = os.networkInterfaces();
for (const ifaceName in interfaces) {
  for (const iface of interfaces[ifaceName]) {
    if (iface.family === 'IPv4' && !iface.internal) {
      console.log(iface.address);
      process.exit(0);
    }
  }
}
console.log('localhost');
")

echo "ğŸ“¡ Detected IP: $LOCAL_IP"

# Check if we're on your specific Mac
if [[ "$LOCAL_IP" == "192.168.4.22" ]] && [[ "$OSTYPE" == "darwin"* ]]; then
  echo "ğŸ–¥ï¸  Detected your development Mac"
  COMMAND="npm run start:lan"
elif [[ "$OSTYPE" == "darwin"* ]]; then
  # Mac but not your specific one
  echo "ğŸ’» Detected Mac"
  COMMAND="npm start"
elif [[ -n "$CODESPACES" ]] || [[ -n "$GITHUB_CODESPACE" ]]; then
  echo "ğŸŒ Detected Codespaces"
  COMMAND="npm run start:ipad"
elif [[ "$OSTYPE" == "linux"* ]] && [[ $(uname -m) == *"arm"* ]]; then
  echo "ğŸ“± Detected iPad/Linux ARM"
  COMMAND="npm run start:ipad"
else
  echo "ğŸ–¥ï¸  Generic environment"
  COMMAND="npm start"
fi

echo ""
echo "ğŸ”§ Running: $COMMAND"
echo "=============================="

# Execute the command
eval $COMMAND